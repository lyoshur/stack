---
title: JVM内存结构
description: Java高并发编程详解：多线程与架构设计（汪文君）- JVM内存结构
slug: Java高并发编程详解：多线程与架构设计（汪文君）- JVM内存结构
date: 2022-08-15 11:22:00+0000
categories:
    - Java高并发编程详解：多线程与架构设计（汪文君）
tags:
    - Java
---

# JVM内存结构

JVM在执行java程序时会把对应的物理内存划分成不同的区域，有些分区随着JVM启动而创建，有些则是运行时才创建。

## 1 程序计数器

程序计数器用于存放当前线程接下来要执行的字节码指令、分支、循环、跳转、异常处理等信息。每个线程都有自己独立的程序计数器，因此这块区域是线程私有的。

这是一块比较小的内存，且不会出现任何溢出异常。

## 2 JAVA虚拟机栈

虚拟机栈在JVM运行时建立的（这里的运行时，应该是因为程序计数器、JAVA虚拟机栈、本地方法栈都是线程私有的所以需要在线程运行起来时创建）他的生命周期与线程相同，方法在执行时，会创建一个名为栈帧（stack frame）的数据结构，主要用于存放局部变量表、操作栈、动态链接、方法出口等信息。

方法的调用与退出对应着栈帧在虚拟机栈中的压栈和弹栈过程。

栈内存的分配大小直接决定了在一个JVM进程中可以创建多少个线程。

## 3 本地方法栈

在调用JNI方法时，JVM为本地方法提供的内存区域是本地方法栈，这块区域的内存自由度相当高。完全由不同的JVM厂商实现。线程私有。

## 4 堆内存

JVM中最大的一块内存区域，被线程所共享，Java在运行期间创建的所有对象几乎都在堆内存。该内存区域也是垃圾回收重点照顾的区域。因此堆内存有时也称为GC堆。

堆内存一般会被细分为新生代和老年代。更细致的划分为Eden区（伊甸园区）、From Survivor(幸存者区 S0)、To Survivor(幸存者区 S1)。

## 5 方法区 （1.7-）

主要用于存储已经被虚拟机加载的类信息，常量静态变量，JIT编译后的代码等数据。虽然在JVM规范中，将方法区划分为堆内存的一个逻辑分区。但是它经常还是被称为非堆。有时也被叫为持久代。

## 6 元空间 （1.8）

自从JDK1.8起，持久代被元空间取而代之（Meta Space）。元空间同样是堆内存的一部分，JVM为每个类加载器分配一块内存块列表，进行线性分配。块的大小取决于类加载器的类型，sun、反射、代理对应的类加载器会小一点。之前的版本会单独卸载回收掉某个类，而现在则是在GC的过程中发现某个类加载器已经具备回收的条件，则会将某个类加载器相关的元空间全部回收，这样可以减少内存碎片，节省GC扫描和压缩的时间。

