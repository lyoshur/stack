---
title: 常见的限流算法
description: #
slug: 常见的限流算法
date: 2022-08-26 09:24:00+0000
categories:
    - Java
tags:
    - java
---

# 常见的限流算法

**限流**顾名思义，就是对请求或并发数进行限制；通过对一个时间窗口内的请求量进行限制来保障系统的正常运行。如果我们的服务资源有限、处理能力有限，就需要对调用我们服务的上游请求进行限制，以防止自身服务由于资源耗尽而停止服务。

## 1 固定窗口算法（计数器算法）（Fixed Window）

**固定窗口算法**又叫**计数器算法**，是一种**简单**方便的限流算法。主要通过一个支持**原子操作**的计数器来累计 1 秒内的请求次数，当 1 秒内计数达到限流阈值时触发拒绝策略。每过 1 秒，计数器重置为 0 开始重新计数。

【note】思路就是每收到一个请求，计数器加1 ，同时有一个专用的线程，按每秒将计数器归零。

## 2 滑动窗口算法（Rolling Window 或 Sliding Window）

【note】滑动窗口是对于固定窗口的改进，固定窗口算法当达到一个时间周期时，都会将计数器归零。而滑动窗口的大致思路是，每过半个周期或更细的时间单位，将窗口前移。然后统计当前窗口的计数器。相比固定窗口算法，不会每次都简单的将计数器归零，有了更平滑的限制策略。

## 3 漏桶算法（Leaky Bucket）

【note】漏桶是一个可以容纳请求的容器，当收到一个请求时，如果桶内有空间，则将请求置入桶内，等待处理。如果桶内空间不足，则直接触发限流策略。所以瞬间能接受的请求量是桶容量上限，当桶满后，最大处理速度是漏桶的漏出速度。

## 4 令牌桶算法（Token Bucket）

令牌桶算法同样是实现限流是一种常见的思路，最为常用的 Google 的 Java 开发工具包 Guava 中的限流工具类 RateLimiter 就是令牌桶的一个实现。

【note】令牌桶是一个容纳令牌的容器，有一个线程以恒定速率向令牌桶中放置令牌。相比漏桶，令牌桶在刚启动时，由于桶内没有令牌，会有一个慢启动的过程。然后令牌桶才能到达最大的容量上限。

瞬间能够接受的请求，是当前令牌桶内令牌的数量。当令牌消耗殆尽时，最大处理速度是令牌的生产速度

## 5 漏桶对比令牌桶

- 当大量请求时，漏桶会被装满，而令牌桶会被消耗光。
- 当大量请求时，漏桶新接受请求的速度，等于漏桶的漏出速度，也就是处理速度。这里会以最大处理能力进行处理。而令牌桶会以恒定的令牌放置速度处理，当令牌生产速度过小时，会产生性能浪费。而过大时会导致限流无效。
- 令牌桶如果初始化令牌数为0，会有一个慢启动的过程。而漏桶不会。

